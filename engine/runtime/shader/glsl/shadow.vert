#version 450

// ============================================================================
// 阴影贴图生成顶点着色器
// ============================================================================
/**
 * @file shadow.vert
 * @brief 阴影贴图生成专用顶点着色器
 * @details 用于从光源视角渲染场景，生成深度信息到阴影贴图
 *          
 *          阴影贴图技术原理：
 *          1. 第一遍渲染：从光源视角渲染场景，只记录深度值
 *          2. 第二遍渲染：从相机视角渲染，比较片段深度与阴影贴图
 *          3. 如果片段深度大于阴影贴图深度，则该片段处于阴影中
 *          
 *          变换流程：
 *          局部坐标 -> 世界坐标 -> 光源视图坐标 -> 光源裁剪坐标
 */

// ============================================================================
// 推送常量 - 模型变换矩阵
// ============================================================================
/**
 * @brief 模型变换推送常量
 * @details 使用推送常量传递模型矩阵，避免频繁更新uniform buffer
 *          推送常量适合小量、高频更新的数据（如每个物体的模型矩阵）
 */
layout( push_constant ) uniform ModelConstants
{
    mat4 model;  // 模型变换矩阵：局部空间 -> 世界空间
} modelConst;

// ============================================================================
// Uniform缓冲对象 - 光源视图变换
// ============================================================================
/**
 * @brief 光源视角的视图和投影矩阵
 * @details 从光源位置和方向计算的变换矩阵，用于生成阴影贴图
 */
layout(set = 0, binding = 0) uniform uniformbuffer
{
	mat4 view;  // 光源视图矩阵：世界空间 -> 光源视图空间
	mat4 proj;  // 光源投影矩阵：光源视图空间 -> 光源裁剪空间
} ubo;

// ============================================================================
// 顶点输入属性
// ============================================================================
/**
 * 顶点着色器输入数据
 */
layout(location = 0) in vec3 inPosition;  // 顶点局部坐标位置
layout(location = 1) in vec3 inNormal;    // 顶点法向量（阴影渲染中未使用）
layout(location = 2) in vec3 inColor;     // 顶点颜色（阴影渲染中未使用）
layout(location = 3) in vec2 inTexCoord;  // 纹理坐标（阴影渲染中未使用）

// ============================================================================
// 主函数 - 顶点变换
// ============================================================================
/**
 * @brief 阴影贴图顶点变换
 * @details 将顶点从局部空间变换到光源的裁剪空间
 *          
 *          变换矩阵链：
 *          P_clip = P_proj × P_view × P_model × P_local
 *          
 *          其中：
 *          - P_local：顶点局部坐标
 *          - P_model：模型变换矩阵（局部->世界）
 *          - P_view：光源视图矩阵（世界->光源视图）
 *          - P_proj：光源投影矩阵（光源视图->光源裁剪）
 *          - P_clip：最终裁剪空间坐标
 */
void main()
{
    // ========================================================================
    // 完整的顶点变换管线
    // ========================================================================
    
    // 变换顶点位置：投影矩阵 × 视图矩阵 × 模型矩阵 × 顶点位置
    // 这将顶点从局部空间变换到光源的裁剪空间
	gl_Position = ubo.proj * ubo.view * modelConst.model * vec4(inPosition, 1.0);
    
    // 注意：阴影贴图渲染不需要输出颜色、纹理坐标等信息
    // 只需要深度值，这些会自动写入深度缓冲区
}